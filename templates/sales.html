{% extends "base.html" %}

{% block title %}판매 관리 - 재고관리 시스템{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1>판매 관리</h1>
    <a href="/sales/add" class="btn btn-success">판매 기록 추가</a>
</div>

<div class="row mb-3">
    <div class="col-md-12">
        <form method="get" action="/sales" class="row g-3">
            <div class="col-md-4">
                <label for="start_date" class="form-label">시작일</label>
                <input type="date" class="form-control" id="start_date" name="start_date" value="{{ start_date }}">
            </div>
            <div class="col-md-4">
                <label for="end_date" class="form-label">종료일</label>
                <input type="date" class="form-control" id="end_date" name="end_date" value="{{ end_date }}">
            </div>
            <div class="col-md-4">
                <label class="form-label">&nbsp;</label>
                <button type="submit" class="btn btn-primary d-block w-100">조회</button>
            </div>
        </form>
    </div>
</div>

<div class="row mb-4">
    <div class="col-md-3">
        <div class="card bg-primary text-white">
            <div class="card-body">
                <h6 class="card-title">총 판매 건수</h6>
                <h3 class="card-text">{{ summary.total_sales }}</h3>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-success text-white">
            <div class="card-body">
                <h6 class="card-title">총 판매 수량</h6>
                <h3 class="card-text">{{ summary.total_quantity }}</h3>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-info text-white">
            <div class="card-body">
                <h6 class="card-title">총 매출</h6>
                <h3 class="card-text">₩{{ "{:,.0f}".format(summary.total_revenue) }}</h3>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-warning text-white">
            <div class="card-body">
                <h6 class="card-title">총 순이익</h6>
                <h3 class="card-text">₩{{ "{:,.0f}".format(summary.total_profit) }}</h3>
            </div>
        </div>
    </div>
</div>

{% if summary.platform_stats %}
<div class="row mb-4">
    <div class="col-md-12">
        <h4>플랫폼별 실적</h4>
        <div class="row">
            {% for platform, stats in summary.platform_stats.items() %}
            <div class="col-md-4">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">플랫폼 {{ platform }}</h5>
                        <p class="card-text">
                            판매 건수: {{ stats.sales_count }}<br>
                            판매 수량: {{ stats.quantity }}<br>
                            매출: ₩{{ "{:,.0f}".format(stats.revenue) }}<br>
                            순이익: ₩{{ "{:,.0f}".format(stats.profit) }}
                        </p>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endif %}

<div class="table-responsive">
    <h4>판매 내역</h4>
    <table class="table table-hover">
        <thead>
            <tr>
                <th>판매일</th>
                <th>상품명</th>
                <th>수량</th>
                <th>플랫폼</th>
                <th>매출</th>
                <th>순이익</th>
                <th>기록일시</th>
            </tr>
        </thead>
        <tbody>
            {% for sale in sales %}
            <tr>
                <td>{{ sale.sale_date }}</td>
                <td>{{ sale.product_name }}</td>
                <td>{{ sale.quantity }}</td>
                <td><span class="badge bg-secondary">{{ sale.platform }}</span></td>
                <td>₩{{ "{:,.0f}".format(sale.revenue) }}</td>
                <td>₩{{ "{:,.0f}".format(sale.profit) }}</td>
                <td>{{ sale.created_at }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% if not sales %}
<div class="alert alert-info text-center">
    선택한 기간에 판매 내역이 없습니다.
</div>
{% endif %}
{% endblock %}